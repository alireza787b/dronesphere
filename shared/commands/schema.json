{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://dronesphere.ai/schemas/command/v1",
  "type": "object",
  "title": "DroneCommand",
  "description": "Schema for defining drone commands in DroneSphere",
  "required": ["apiVersion", "kind", "metadata", "spec"],
  "properties": {
    "apiVersion": {
      "type": "string",
      "description": "Version of the command schema",
      "pattern": "^v[0-9]+$",
      "examples": ["v1"]
    },
    "kind": {
      "type": "string",
      "description": "Type of resource",
      "enum": ["DroneCommand"]
    },
    "metadata": {
      "type": "object",
      "description": "Command metadata",
      "required": ["name", "category"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Unique command identifier",
          "pattern": "^[a-z0-9_]+$"
        },
        "category": {
          "type": "string",
          "description": "Command category",
          "enum": ["flight", "navigation", "camera", "sensor", "custom"]
        },
        "tags": {
          "type": "array",
          "description": "Command tags for grouping",
          "items": {
            "type": "string"
          }
        },
        "version": {
          "type": "string",
          "description": "Command version",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
          "default": "1.0.0"
        },
        "deprecated": {
          "type": "boolean",
          "description": "Whether this command is deprecated",
          "default": false
        }
      }
    },
    "spec": {
      "type": "object",
      "description": "Command specification",
      "required": ["description", "parameters", "implementation"],
      "properties": {
        "description": {
          "type": "object",
          "required": ["brief"],
          "properties": {
            "brief": {
              "type": "string",
              "description": "Short command description"
            },
            "detailed": {
              "type": "string",
              "description": "Detailed command explanation"
            },
            "examples": {
              "type": "array",
              "description": "Usage examples",
              "items": {
                "type": "object",
                "required": ["text"],
                "properties": {
                  "text": {
                    "type": "string",
                    "description": "Example user input"
                  },
                  "params": {
                    "type": "object",
                    "description": "Resulting parameters"
                  },
                  "language": {
                    "type": "string",
                    "description": "Language code",
                    "default": "en"
                  }
                }
              }
            }
          }
        },
        "parameters": {
          "type": "object",
          "description": "Command parameters definition",
          "patternProperties": {
            "^[a-z_]+$": {
              "type": "object",
              "required": ["type"],
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["float", "integer", "string", "boolean", "array", "object"]
                },
                "required": {
                  "type": "boolean",
                  "default": false
                },
                "default": {
                  "description": "Default value if not provided"
                },
                "constraints": {
                  "type": "object",
                  "properties": {
                    "min": {
                      "type": "number"
                    },
                    "max": {
                      "type": "number"
                    },
                    "enum": {
                      "type": "array"
                    },
                    "pattern": {
                      "type": "string"
                    },
                    "unit": {
                      "type": "string"
                    }
                  }
                },
                "description": {
                  "type": "string"
                }
              }
            }
          }
        },
        "implementation": {
          "type": "object",
          "description": "Implementation details",
          "required": ["handler"],
          "properties": {
            "handler": {
              "type": "string",
              "description": "Python handler class path"
            },
            "supported_backends": {
              "type": "array",
              "description": "Supported drone backends",
              "items": {
                "type": "string",
                "enum": ["mavsdk", "pymavlink", "mock"]
              },
              "default": ["mavsdk"]
            },
            "timeout": {
              "type": "integer",
              "description": "Command timeout in seconds",
              "default": 30
            }
          }
        },
        "safety": {
          "type": "object",
          "description": "Safety requirements",
          "properties": {
            "pre_checks": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "battery_min": {
                    "type": "integer",
                    "description": "Minimum battery percentage"
                  },
                  "gps_fix": {
                    "type": "boolean",
                    "description": "GPS fix required"
                  },
                  "altitude_max": {
                    "type": "number",
                    "description": "Maximum altitude allowed"
                  },
                  "clear_above": {
                    "type": "boolean",
                    "description": "Check for obstacles above"
                  }
                }
              }
            },
            "emergency_action": {
              "type": "string",
              "description": "Action to take in emergency",
              "enum": ["land", "rtl", "hover", "none"],
              "default": "hover"
            }
          }
        }
      }
    }
  },
  "examples": [
    {
      "apiVersion": "v1",
      "kind": "DroneCommand",
      "metadata": {
        "name": "takeoff",
        "category": "flight",
        "tags": ["basic", "vertical"],
        "version": "1.0.0"
      },
      "spec": {
        "description": {
          "brief": "Take off to specified altitude",
          "detailed": "Arms the drone and takes off vertically to the specified altitude",
          "examples": [
            {
              "text": "Take off to 20 meters",
              "params": {"altitude": 20}
            },
            {
              "text": "برخیز به ارتفاع ۱۰ متر",
              "params": {"altitude": 10},
              "language": "fa"
            }
          ]
        },
        "parameters": {
          "altitude": {
            "type": "float",
            "required": true,
            "constraints": {
              "min": 1,
              "max": 120,
              "unit": "meters"
            },
            "description": "Target altitude in meters"
          }
        },
        "implementation": {
          "handler": "basic_commands.TakeoffCommand",
          "supported_backends": ["mavsdk", "pymavlink"],
          "timeout": 30
        },
        "safety": {
          "pre_checks": [
            {"battery_min": 30},
            {"gps_fix": true}
          ],
          "emergency_action": "land"
        }
      }
    }
  ]
}
